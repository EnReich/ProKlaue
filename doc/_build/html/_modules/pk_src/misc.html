
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
        <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>pk_src.misc &#8212; ProKlaue 0.3.4 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pk_src.misc</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module with a few helper functions for plugin *ProKlaue*.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">maya.api.OpenMaya</span> <span class="k">as</span> <span class="nn">om2</span>
<span class="kn">import</span> <span class="nn">maya.OpenMaya</span> <span class="k">as</span> <span class="nn">om</span>
<span class="kn">import</span> <span class="nn">maya.cmds</span> <span class="k">as</span> <span class="nn">cmds</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="n">RAD_TO_DEG</span> <span class="o">=</span> <span class="mi">180</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
<span class="n">DEG_TO_RAD</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
<span class="n">GRAD_TO_RAD</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>

<span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
              <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
              <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>


<div class="viewcode-block" id="getArgObj"><a class="viewcode-back" href="../../pk_src.misc.html#pk_src.misc.getArgObj">[docs]</a><span class="k">def</span> <span class="nf">getArgObj</span><span class="p">(</span><span class="n">syntax</span><span class="p">,</span> <span class="n">argList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to return list of objects from argument list (throws exception if no object is given or selected).</span>

<span class="sd">    :param syntax: Function to syntax definition of current command</span>
<span class="sd">    :type syntax: OpenMaya.MSyntax (api 1.0)</span>
<span class="sd">    :param argList: Argument list for command</span>
<span class="sd">    :raises AttributeError: Raised when no object is selected</span>

<span class="sd">    :returns: list of object names in argument list (or from current selection)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">argData</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">MArgParser</span><span class="p">(</span><span class="n">syntax</span><span class="p">,</span> <span class="n">argList</span><span class="p">)</span>
    <span class="n">objStrings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">argData</span><span class="o">.</span><span class="n">getObjects</span><span class="p">(</span><span class="n">objStrings</span><span class="p">)</span>
    <span class="c1"># check if objects are selected or object is given as argument (only use first selection/argument)</span>
    <span class="n">selList</span> <span class="o">=</span> <span class="n">cmds</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="n">orderedSelection</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">objStrings</span> <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">objStrings</span><span class="p">))</span> <span class="k">else</span> <span class="n">selList</span>
        <span class="c1">#obj = selList[0] if (len(selList)) else objStrings[0]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;No object selected&#39;</span><span class="p">)</span></div>
    <span class="k">return</span> <span class="n">obj</span>

<div class="viewcode-block" id="getMesh"><a class="viewcode-back" href="../../pk_src.misc.html#pk_src.misc.getMesh">[docs]</a><span class="k">def</span> <span class="nf">getMesh</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to return mesh object from dag path.</span>

<span class="sd">    :param obj: name of object</span>
<span class="sd">    :type obj: string</span>
<span class="sd">    :returns: MFnMesh object (api 2.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># put name of object into selection list</span>
    <span class="n">selectionLs</span> <span class="o">=</span> <span class="n">om2</span><span class="o">.</span><span class="n">MSelectionList</span><span class="p">()</span>
    <span class="n">selectionLs</span><span class="o">.</span><span class="n">add</span> <span class="p">(</span> <span class="n">obj</span> <span class="p">)</span>
    <span class="c1"># Get the dag path of the first item in the selection list</span>
    <span class="n">dag</span> <span class="o">=</span> <span class="n">selectionLs</span><span class="o">.</span><span class="n">getDagPath</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># create a Mesh functionset from our dag object</span></div>
    <span class="k">return</span> <span class="p">(</span><span class="n">om2</span><span class="o">.</span><span class="n">MFnMesh</span><span class="p">(</span><span class="n">dag</span><span class="p">))</span>

<div class="viewcode-block" id="getPoints"><a class="viewcode-back" href="../../pk_src.misc.html#pk_src.misc.getPoints">[docs]</a><span class="k">def</span> <span class="nf">getPoints</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">mfnObject</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">worldSpace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to return MPointArray with points of object&#39;s mesh.</span>

<span class="sd">    :param obj: name of object</span>
<span class="sd">    :type obj: string</span>
<span class="sd">    :param mfnObject: mesh object</span>
<span class="sd">    :type mfnObject: MFnMesh</span>
<span class="sd">    :param worldSpace: should coordinates be in world space (with transform) or in local space (without transform); default True</span>
<span class="sd">    :type worldSpace: Boolean</span>
<span class="sd">    :returns: MPointArray (api 2.0)</span>

<span class="sd">    **Example:**</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            from pk_src import misc</span>
<span class="sd">            cmds.polyCube()</span>
<span class="sd">            # Result: [u&#39;pCube1&#39;, u&#39;polyCube1&#39;] #</span>
<span class="sd">            cmds.xform(t = [2,1,0])</span>
<span class="sd">            # vertices in local space (without transform)</span>
<span class="sd">            misc.getPoints(&quot;pCube1&quot;, worldSpace = 0)</span>
<span class="sd">            # Result: maya.api.OpenMaya.MPointArray([maya.api.OpenMaya.MPoint(-0.5, -0.5, 0.5, 1), maya.api.OpenMaya.MPoint(0.5, -0.5, 0.5, 1), maya.api.OpenMaya.MPoint(-0.5, 0.5, 0.5, 1), maya.api.OpenMaya.MPoint(0.5, 0.5, 0.5, 1), maya.api.OpenMaya.MPoint(-0.5, 0.5, -0.5, 1), maya.api.OpenMaya.MPoint(0.5, 0.5, -0.5, 1), maya.api.OpenMaya.MPoint(-0.5, -0.5, -0.5, 1), maya.api.OpenMaya.MPoint(0.5, -0.5, -0.5, 1)]) #</span>
<span class="sd">            # vertices in world space (with transform)</span>
<span class="sd">            misc.getPoints(&quot;pCube1&quot;, worldSpace = 1)</span>
<span class="sd">            # Result: maya.api.OpenMaya.MPointArray([maya.api.OpenMaya.MPoint(1.5, 0.5, 0.5, 1), maya.api.OpenMaya.MPoint(2.5, 0.5, 0.5, 1), maya.api.OpenMaya.MPoint(1.5, 1.5, 0.5, 1), maya.api.OpenMaya.MPoint(2.5, 1.5, 0.5, 1), maya.api.OpenMaya.MPoint(1.5, 1.5, -0.5, 1), maya.api.OpenMaya.MPoint(2.5, 1.5, -0.5, 1), maya.api.OpenMaya.MPoint(1.5, 0.5, -0.5, 1), maya.api.OpenMaya.MPoint(2.5, 0.5, -0.5, 1)]) #</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mfnObject</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="c1"># put name of object into selection list</span>
        <span class="n">selectionLs</span> <span class="o">=</span> <span class="n">om2</span><span class="o">.</span><span class="n">MSelectionList</span><span class="p">()</span>
        <span class="n">selectionLs</span><span class="o">.</span><span class="n">add</span> <span class="p">(</span> <span class="n">obj</span> <span class="p">)</span>
        <span class="c1"># Get the dag path of the first item in the selection list</span>
        <span class="n">dag</span> <span class="o">=</span> <span class="n">selectionLs</span><span class="o">.</span><span class="n">getDagPath</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># create a Mesh functionset from our dag object</span>
        <span class="n">mfnObject</span> <span class="o">=</span> <span class="n">om2</span><span class="o">.</span><span class="n">MFnMesh</span><span class="p">(</span><span class="n">dag</span><span class="p">)</span>
    <span class="c1"># set space</span>
    <span class="n">space</span> <span class="o">=</span> <span class="n">om2</span><span class="o">.</span><span class="n">MSpace</span><span class="o">.</span><span class="n">kWorld</span> <span class="k">if</span> <span class="p">(</span><span class="n">worldSpace</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="n">om2</span><span class="o">.</span><span class="n">MSpace</span><span class="o">.</span><span class="n">kObject</span>
    <span class="c1"># get Array of MPoint-Objects --&gt; for better accessing reorganize MPoint-Array to array</span></div>
    <span class="k">return</span> <span class="p">(</span><span class="n">mfnObject</span><span class="o">.</span><span class="n">getPoints</span><span class="p">(</span><span class="n">space</span><span class="p">))</span>


<div class="viewcode-block" id="getPointsAsList"><a class="viewcode-back" href="../../pk_src.misc.html#pk_src.misc.getPointsAsList">[docs]</a><span class="k">def</span> <span class="nf">getPointsAsList</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">worldSpace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to return the points of an object&#39;s mesh in a list of lists with coordinates.</span>

<span class="sd">    :param obj: name of object</span>
<span class="sd">    :type obj: str</span>
<span class="sd">    :param worldSpace: should coordinates be in world space (with transform) or in local space (without transform); default True</span>
<span class="sd">    :type worldSpace: bool</span>
<span class="sd">    :returns: list of lists of coordinates (length 3) of the points of the objects mesh</span>

<span class="sd">    **Example:**</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            from pk_src import misc</span>
<span class="sd">            cmds.polyCube()</span>
<span class="sd">            cmds.xform(&quot;pCube1&quot;, t=[1,0,0])</span>
<span class="sd">            misc.getPointsAsList(&quot;pCube1&quot;, worldSpace=True)</span>
<span class="sd">            # Result: [(0.5, -0.5, 0.5), (1.5, -0.5, 0.5), (0.5, 0.5, 0.5), (1.5, 0.5, 0.5), (0.5, 0.5, -0.5), (1.5, 0.5, -0.5), (0.5, -0.5, -0.5), (1.5, -0.5, -0.5)] #</span>
<span class="sd">            misc.getPointsAsList(&quot;pCube1&quot;, worldSpace=False)</span>
<span class="sd">            # Result: [(-0.5, -0.5, 0.5), (0.5, -0.5, 0.5), (-0.5, 0.5, 0.5), (0.5, 0.5, 0.5), (-0.5, 0.5, -0.5), (0.5, 0.5, -0.5), (-0.5, -0.5, -0.5), (0.5, -0.5, -0.5)] #</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">xOrig</span> <span class="o">=</span> <span class="n">cmds</span><span class="o">.</span><span class="n">xform</span><span class="p">(</span><span class="n">obj</span><span class="o">+</span><span class="s1">&#39;.vtx[*]&#39;</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="n">worldSpace</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">origPts</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xOrig</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">3</span><span class="p">],</span> <span class="n">xOrig</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">3</span><span class="p">],</span> <span class="n">xOrig</span><span class="p">[</span><span class="mi">2</span><span class="p">::</span><span class="mi">3</span><span class="p">])</span></div>
    <span class="k">return</span> <span class="n">origPts</span>

<div class="viewcode-block" id="getFaceNormals"><a class="viewcode-back" href="../../pk_src.misc.html#pk_src.misc.getFaceNormals">[docs]</a><span class="k">def</span> <span class="nf">getFaceNormals</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">worldSpace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to return all face normals. Uses the command `polyInfo &lt;http://download.autodesk.com/us/maya/2011help/Commands/polyInfo.html&gt;`_ to access the normal information as string and parse them to a numpy array</span>

<span class="sd">    :param obj: name of object</span>
<span class="sd">    :type obj: string</span>

<span class="sd">    :returns: list of numpy arrays with the 3 float values for each normal</span>

<span class="sd">    **Example:**</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            from pk_src import misc</span>
<span class="sd">            cmds.polyCube()</span>
<span class="sd">            # Result: [u&#39;pCube1&#39;, u&#39;polyCube1&#39;] #</span>
<span class="sd">            misc.getFaceNormals(&quot;pCube1&quot;)</span>
<span class="sd">            # Result: [[0.0, 0.0, 1.0], [0.0, 1.0, 0.0], [0.0, 0.0, -1.0], [0.0, -1.0, 0.0], [1.0, 0.0, 0.0], [-1.0, 0.0, 0.0]] #</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">normalStrings</span> <span class="o">=</span> <span class="n">cmds</span><span class="o">.</span><span class="n">polyInfo</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">normals</span> <span class="o">=</span> <span class="p">[</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">20</span><span class="p">:(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">normalStrings</span><span class="p">]</span>
    <span class="c1"># if normals should be in world space coordinates, one needs to apply the transformation of the object</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">worldSpace</span><span class="p">):</span>
        <span class="c1"># get transformation matrix and cut away 4th row/column</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">cmds</span><span class="o">.</span><span class="n">xform</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ws</span> <span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># multiply normals with transform, discard 4th value and organize them as list of 3 floats each</span>
        <span class="c1">#normals = [(n * transform).tolist()[0] for n in normals]</span>
        <span class="n">normals</span> <span class="o">=</span> <span class="p">(</span><span class="n">normals</span> <span class="o">*</span> <span class="n">transform</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></div>
    <span class="k">return</span> <span class="p">(</span><span class="n">normals</span><span class="p">)</span>

<div class="viewcode-block" id="getFaceNormals2"><a class="viewcode-back" href="../../pk_src.misc.html#pk_src.misc.getFaceNormals2">[docs]</a><span class="k">def</span> <span class="nf">getFaceNormals2</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">worldSpace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to return all face normals. Uses the command</span>
<span class="sd">    `polyInfo &lt;http://download.autodesk.com/us/maya/2011help/Commands/polyInfo.html&gt;`_</span>
<span class="sd">    to access the normal information as string and parse them to a numpy array.</span>
<span class="sd">    Instead of a transformation matrix this method uses a calculated rotation matrix, and by that does not scale</span>
<span class="sd">    the normals.</span>

<span class="sd">    :param obj: name of object</span>
<span class="sd">    :type obj: string</span>

<span class="sd">    :returns: list of numpy arrays with the 3 float values for each normal</span>

<span class="sd">    **Example:**</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            from pk_src import misc</span>
<span class="sd">            cmds.polyCube()</span>
<span class="sd">            # Result: [u&#39;pCube1&#39;, u&#39;polyCube1&#39;] #</span>
<span class="sd">            misc.getFaceNormals2(&quot;pCube1&quot;)</span>
<span class="sd">            # Result: [[0.0, 0.0, 1.0], [0.0, 1.0, 0.0], [0.0, 0.0, -1.0], [0.0, -1.0, 0.0], [1.0, 0.0, 0.0], [-1.0, 0.0, 0.0]] #</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">normalStrings</span> <span class="o">=</span> <span class="n">cmds</span><span class="o">.</span><span class="n">polyInfo</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">normals</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">20</span><span class="p">:(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">normalStrings</span><span class="p">]</span>
    <span class="c1"># if normals should be in world space coordinates, one needs to apply the rotation of the object</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">worldSpace</span><span class="p">):</span>
        <span class="c1"># get rotation matrix</span>
        <span class="n">rotation_angles</span> <span class="o">=</span> <span class="n">cmds</span><span class="o">.</span><span class="n">xform</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ro</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">rotation_order</span> <span class="o">=</span> <span class="n">cmds</span><span class="o">.</span><span class="n">xform</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">roo</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">rot_mat</span> <span class="o">=</span> <span class="n">getRotationMatrix</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">rotation_angles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">beta</span><span class="o">=</span><span class="n">rotation_angles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">gamma</span><span class="o">=</span><span class="n">rotation_angles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                    <span class="n">order</span><span class="o">=</span><span class="n">rotation_order</span><span class="p">,</span> <span class="n">rad</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># multiply normals with transform</span>
        <span class="n">normals</span> <span class="o">=</span> <span class="p">(</span><span class="n">normals</span> <span class="o">*</span> <span class="n">rot_mat</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></div>
    <span class="k">return</span> <span class="n">normals</span>

<div class="viewcode-block" id="getTriangles"><a class="viewcode-back" href="../../pk_src.misc.html#pk_src.misc.getTriangles">[docs]</a><span class="k">def</span> <span class="nf">getTriangles</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">mfnObject</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to return all triangles in object mesh as nested list. Length of list is equal to number of triangles for the object. Each list element is another list of 3 vertex indices which refer to the point set of the current object mesh.</span>

<span class="sd">    :param obj: name of object</span>
<span class="sd">    :type obj: string</span>
<span class="sd">    :param mfnObject: mesh object</span>
<span class="sd">    :type mfnObject: MFnMesh</span>
<span class="sd">    :returns: numpy.ndarray (e.g. array([[2,1,3],[2,3,4],[4,3,5],[4,5,6],...]) for a polygon cube)</span>

<span class="sd">    **Example:**</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            from pk_src import misc</span>
<span class="sd">            cmds.polyCube()</span>
<span class="sd">            # Result: [u&#39;pCube1&#39;, u&#39;polyCube1&#39;] #</span>
<span class="sd">            misc.getTriangles(&quot;pCube1&quot;)</span>
<span class="sd">            # Result: array([[0, 1, 2],</span>
<span class="sd">                   [2, 1, 3],</span>
<span class="sd">                   [2, 3, 4],</span>
<span class="sd">                   [4, 3, 5],</span>
<span class="sd">                   [4, 5, 6],</span>
<span class="sd">                   [6, 5, 7],</span>
<span class="sd">                   [6, 7, 0],</span>
<span class="sd">                   [0, 7, 1],</span>
<span class="sd">                   [1, 7, 3],</span>
<span class="sd">                   [3, 7, 5],</span>
<span class="sd">                   [6, 0, 4],</span>
<span class="sd">                   [4, 0, 2]]) #</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mfnObject</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="c1"># put name of object into selection list</span>
        <span class="n">selectionLs</span> <span class="o">=</span> <span class="n">om2</span><span class="o">.</span><span class="n">MSelectionList</span><span class="p">()</span>
        <span class="n">selectionLs</span><span class="o">.</span><span class="n">add</span> <span class="p">(</span> <span class="n">obj</span> <span class="p">)</span>
        <span class="c1"># Get the dag path of the first item in the selection list</span>
        <span class="n">dag</span> <span class="o">=</span> <span class="n">selectionLs</span><span class="o">.</span><span class="n">getDagPath</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># create a Mesh functionset from our dag object</span>
        <span class="n">mfnObject</span> <span class="o">=</span> <span class="n">om2</span><span class="o">.</span><span class="n">MFnMesh</span><span class="p">(</span><span class="n">dag</span><span class="p">)</span>
    <span class="c1"># list of triangles indices</span>
    <span class="n">tri</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">mfnObject</span><span class="o">.</span><span class="n">getTriangles</span><span class="p">()[</span><span class="mi">1</span><span class="p">]]</span></div>
    <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span> <span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tri</span><span class="p">))[</span><span class="mi">0</span><span class="p">::</span><span class="mi">3</span><span class="p">]]</span> <span class="p">))</span> <span class="p">)</span>

<div class="viewcode-block" id="getTriangleEdges"><a class="viewcode-back" href="../../pk_src.misc.html#pk_src.misc.getTriangleEdges">[docs]</a><span class="k">def</span> <span class="nf">getTriangleEdges</span><span class="p">(</span><span class="n">triangles</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to return all edges of the given triangle list as dictionary. Given triangle must use indices to point list, so the key-value pairs only contain indices to the vertices&#39; list; key is the index of the current vertex and for each outgoing edge the value contains an index to the corresponding vertex. Values are always lists of indices.</span>

<span class="sd">    :param triangles: list of triangle definitions (in index represenation, see *misc.getTriangles*)</span>
<span class="sd">    :type triangles: [[1, 2, 3], [1, 3, 4], ...]</span>
<span class="sd">    :returns: dict (keys: index of current vertex, values: list of vertices with existing edge)</span>

<span class="sd">    **Example:**</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            from pk_src import misc</span>
<span class="sd">            cmds.polyCube()</span>
<span class="sd">            # Result: [u&#39;pCube1&#39;, u&#39;polyCube1&#39;] # </span>
<span class="sd">            cmds.polyTriangulate()</span>
<span class="sd">            # Result: [u&#39;polyTriangulate1&#39;] # </span>
<span class="sd">            misc.getTriangleEdges(misc.getTriangles(&quot;pCube1&quot;))</span>
<span class="sd">            # Result: {0: [1, 2, 4, 6, 7], </span>
<span class="sd">                    1: [0, 2, 3, 7], </span>
<span class="sd">                    2: [0, 1, 3, 4], </span>
<span class="sd">                    3: [1, 2, 4, 5, 7], </span>
<span class="sd">                    4: [0, 2, 3, 5, 6], </span>
<span class="sd">                    5: [3, 4, 6, 7], </span>
<span class="sd">                    6: [0, 4, 5, 7], </span>
<span class="sd">                    7: [0, 1, 3, 5, 6]} # </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># initialize dictionary with edge connections</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># for each triangle definition add list of edges</span>
    <span class="k">for</span> <span class="n">tri</span> <span class="ow">in</span> <span class="n">triangles</span><span class="p">:</span>
        <span class="c1"># each vertex has 2 outgoing edges, if index already exist as key in dictionary, add the two other indices to the value-list and eliminate duplicates</span>
        <span class="n">edges</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]]))</span> <span class="k">if</span> <span class="p">(</span><span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
        <span class="n">edges</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]]))</span> <span class="k">if</span> <span class="p">(</span><span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
        <span class="n">edges</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))</span> <span class="k">if</span> <span class="p">(</span><span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span></div>
    <span class="k">return</span> <span class="n">edges</span>

<div class="viewcode-block" id="getTriangleEdgesCount"><a class="viewcode-back" href="../../pk_src.misc.html#pk_src.misc.getTriangleEdgesCount">[docs]</a><span class="k">def</span> <span class="nf">getTriangleEdgesCount</span><span class="p">(</span><span class="n">triangles</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to return the reference count of all  edges of the given triangle list as dictionary. Given triangle must use indices to point list, so the key-value pairs only contain indices to the vertices&#39; list; key is the set of indices of the current vertex-pair for an edge and the value contains the count of triangles with a reference to that edge. Values are always integer. Only edges with at least 1 reference appear in the dict.</span>

<span class="sd">    :param triangles: list of triangle definitions (in index represenation, see *misc.getTriangles*)</span>
<span class="sd">    :type triangles: [[1, 2, 3], [1, 3, 4], ...]</span>
<span class="sd">    :returns: dict (keys: a frozenset with exactly 2 indices of vertices, values: count of triangles which reference the given edge)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># initialize dictionary with edge counts</span>
    <span class="n">edgeCount</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># for each triangle definition count references of edges</span>
    <span class="k">for</span> <span class="n">tri</span> <span class="ow">in</span> <span class="n">triangles</span><span class="p">:</span>
        <span class="n">edgeCount</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">([</span><span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">]])]</span> <span class="o">=</span> <span class="n">edgeCount</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">([</span><span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">edgeCount</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">([</span><span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]])]</span> <span class="o">=</span> <span class="n">edgeCount</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">([</span><span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">edgeCount</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">([</span><span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]])]</span> <span class="o">=</span> <span class="n">edgeCount</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">([</span><span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span></div>
    <span class="k">return</span> <span class="n">edgeCount</span>

<div class="viewcode-block" id="getTriangleEdgesReferences"><a class="viewcode-back" href="../../pk_src.misc.html#pk_src.misc.getTriangleEdgesReferences">[docs]</a><span class="k">def</span> <span class="nf">getTriangleEdgesReferences</span><span class="p">(</span><span class="n">triangles</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to return the references to face indices of all  edges of the given triangle list as dictionary. Given triangle must use indices to point list, so the key-value pairs only contain indices to the vertices&#39; list; key is the set of indices of the current vertex-pair for an edge and the value contains a set of triangle indices with a reference to that edge. Values are always integer. Only edges with at least 1 reference appear in the dict.</span>

<span class="sd">    :param triangles: list of triangle definitions (in index represenation, see *misc.getTriangles*)</span>
<span class="sd">    :type triangles: [[1, 2, 3], [1, 3, 4], ...]</span>
<span class="sd">    :returns: dict (keys: a frozenset with exactly 2 indices of vertices, values: set of triangle indices which reference the given edge)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># initialize dictionary with edge counts</span>
    <span class="n">edgeRefs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># for each triangle definition count references of edges</span>
    <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">tri</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">triangles</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">frozenset</span><span class="p">([</span><span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span> <span class="ow">in</span> <span class="n">edgeRefs</span><span class="p">:</span>
            <span class="n">edgeRefs</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">([</span><span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">]])]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">edgeRefs</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">([</span><span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">]])]</span> <span class="o">=</span> <span class="p">{</span><span class="n">ind</span><span class="p">}</span>

        <span class="k">if</span> <span class="nb">frozenset</span><span class="p">([</span><span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span> <span class="ow">in</span> <span class="n">edgeRefs</span><span class="p">:</span>
            <span class="n">edgeRefs</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">([</span><span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]])]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">edgeRefs</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">([</span><span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]])]</span> <span class="o">=</span> <span class="p">{</span><span class="n">ind</span><span class="p">}</span>

        <span class="k">if</span> <span class="nb">frozenset</span><span class="p">([</span><span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span> <span class="ow">in</span> <span class="n">edgeRefs</span><span class="p">:</span>
            <span class="n">edgeRefs</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">([</span><span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]])]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">edgeRefs</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">([</span><span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]])]</span> <span class="o">=</span> <span class="p">{</span><span class="n">ind</span><span class="p">}</span>
</div>
    <span class="k">return</span> <span class="n">edgeRefs</span>

<div class="viewcode-block" id="areaTriangle"><a class="viewcode-back" href="../../pk_src.misc.html#pk_src.misc.areaTriangle">[docs]</a><span class="k">def</span> <span class="nf">areaTriangle</span><span class="p">(</span><span class="n">vertices</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the area of a triangle given its three vertices.</span>

<span class="sd">    :param vertices: list of 3 vertices defining the triangle</span>
<span class="sd">    :returns: float value with area of triangle</span>

<span class="sd">    **Example:**</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            from pk_src import misc</span>
<span class="sd">            cmds.polyCube()</span>
<span class="sd">            # Result: [u&#39;pCube1&#39;, u&#39;polyCube1&#39;] #</span>
<span class="sd">            points = [[p.x, p.y, p.z] for p in misc.getPoints(&quot;pCube1&quot;)]</span>
<span class="sd">            misc.areaTriangle([points[0], points[1], points[2]])</span>
<span class="sd">            # Result: 0.5 #</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">AB</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">,</span> <span class="n">vertices</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">AC</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">,</span> <span class="n">vertices</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="c1"># calculate area of triangle with half of the cross-product vector</span>
    <span class="n">area</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>   <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">AB</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">AC</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">AB</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">AC</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">AB</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">AC</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">AB</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">AC</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">AB</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">AC</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">AB</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">AC</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="p">)</span></div>
    <span class="k">return</span> <span class="n">area</span>

<div class="viewcode-block" id="centroidTriangle"><a class="viewcode-back" href="../../pk_src.misc.html#pk_src.misc.centroidTriangle">[docs]</a><span class="k">def</span> <span class="nf">centroidTriangle</span> <span class="p">(</span><span class="n">vertices</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the centroid of a triangle given its three vertices.</span>

<span class="sd">    :param vertices: list of 3 vertices defining the triangle</span>
<span class="sd">    :returns: list of 3 float values representing the 3D-coordinates of the triangle&#39;s centroid</span>

<span class="sd">    **Example:**</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            from pk_src import misc</span>
<span class="sd">            cmds.polyCube()</span>
<span class="sd">            # Result: [u&#39;pCube1&#39;, u&#39;polyCube1&#39;] #</span>
<span class="sd">            points = [[p.x, p.y, p.z] for p in misc.getPoints(&quot;pCube1&quot;)]</span>
<span class="sd">            misc.centroidTriangle([points[0], points[1], points[2]])</span>
<span class="sd">            # Result: [-0.16666666666666666, -0.16666666666666666, 0.5] #</span>
<span class="sd">    &quot;&quot;&quot;</span></div>
    <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">mul</span><span class="p">,</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="nb">map</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">vertices</span><span class="p">),</span> <span class="p">[</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span>

<div class="viewcode-block" id="project"><a class="viewcode-back" href="../../pk_src.misc.html#pk_src.misc.project">[docs]</a><span class="k">def</span> <span class="nf">project</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Orthogonal projection of one vector onto another.</span>

<span class="sd">    :param p: vector to be projected</span>
<span class="sd">    :type p: [x,y,z]</span>
<span class="sd">    :param v: vector where p shall be projected to</span>
<span class="sd">    :type v: [x,y,z]</span>
<span class="sd">    :returns: orthogonal projection vector [x,y,z]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span></div>
    <span class="k">return</span> <span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">mul</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="p">[</span><span class="n">t1</span><span class="o">*</span><span class="n">t2</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">))</span>

<div class="viewcode-block" id="signedVolumeOfTriangle"><a class="viewcode-back" href="../../pk_src.misc.html#pk_src.misc.signedVolumeOfTriangle">[docs]</a><span class="k">def</span> <span class="nf">signedVolumeOfTriangle</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Calculates signed volume of given triangle (volume of tetrahedron with triangle topped off at origin (0,0,0))</span>

<span class="sd">    :param p1: first point of triangle</span>
<span class="sd">    :type p1: [x,y,z]</span>
<span class="sd">    :param p2: second point of triangle</span>
<span class="sd">    :type p2: [x,y,z]</span>
<span class="sd">    :param p3: third point of triangle</span>
<span class="sd">    :type p3: [x,y,z]</span>
<span class="sd">    :param center: top of tetrahedron (default (0,0,0))</span>
<span class="sd">    :type center: [x,y,z]</span>
<span class="sd">    :returns: signed volume of tetrahedron</span>

<span class="sd">    **Example:**</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            from pk_src import misc</span>
<span class="sd">            cmds.polyCube()</span>
<span class="sd">            # Result: [u&#39;pCube1&#39;, u&#39;polyCube1&#39;] #</span>
<span class="sd">            points = [[p.x, p.y, p.z] for p in misc.getPoints(&quot;pCube1&quot;)]</span>
<span class="sd">            misc.signedVolumeOfTriangle(points[0], points[1], points[2])</span>
<span class="sd">            # Result: 0.08333333333333333 #</span>

<span class="sd">            # Volume of whole object</span>
<span class="sd">            triangles = misc.getTriangles(&quot;pCube1&quot;)</span>
<span class="sd">            reduce(lambda x,y: x+y, [misc.signedVolumeOfTriangle(points[tri[0]], points[tri[1]], points[tri[2]]) for tri in triangles])</span>
<span class="sd">            # Result: 1.0 #</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">center</span> <span class="o">!=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">center</span><span class="p">)</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">center</span><span class="p">)</span>
        <span class="n">p3</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">center</span><span class="p">)</span>

    <span class="n">v123</span> <span class="o">=</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">p3</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">v132</span> <span class="o">=</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">p3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">v213</span> <span class="o">=</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">p3</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">v231</span> <span class="o">=</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">p3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">v312</span> <span class="o">=</span> <span class="n">p3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">v321</span> <span class="o">=</span> <span class="n">p3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</div>
    <span class="k">return</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">6.0</span> <span class="o">*</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">,</span> <span class="p">[</span><span class="n">v123</span><span class="p">,</span> <span class="o">-</span><span class="n">v132</span><span class="p">,</span> <span class="n">v312</span><span class="p">,</span> <span class="o">-</span><span class="n">v213</span><span class="p">,</span> <span class="n">v231</span><span class="p">,</span> <span class="o">-</span><span class="n">v321</span><span class="p">]))</span>

<div class="viewcode-block" id="alignYAxis"><a class="viewcode-back" href="../../pk_src.misc.html#pk_src.misc.alignYAxis">[docs]</a><span class="k">def</span> <span class="nf">alignYAxis</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Calculates the necessary rotations to align the y axis of one object with the position of another object, i.e. the local y-vector of the first selected objects will point towards the position (in worldspace) of the second selected object.</span>

<span class="sd">    If not exactly two objects are selected, a warning message will be displayed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># normalization of 3d vector</span>
    <span class="n">normalize</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="nb">map</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">div</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">])]</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span>
    <span class="c1"># sign function (returns +1 true iff given value is greater 0, -1 iff given value is less 0, and 0 if value equals 0)</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">objList</span> <span class="o">=</span> <span class="n">cmds</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="n">orderedSelection</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">objList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
        <span class="c1"># vector FROM 1st TO 2nd selected object</span>
        <span class="n">t</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">,</span> <span class="n">cmds</span><span class="o">.</span><span class="n">xform</span><span class="p">(</span><span class="n">objList</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">q</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ws</span> <span class="o">=</span> <span class="mi">1</span><span class="p">),</span> <span class="n">cmds</span><span class="o">.</span><span class="n">xform</span><span class="p">(</span><span class="n">objList</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ws</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="c1"># calculate angles a and z (rotation around x and z axis)</span>
        <span class="c1"># calculation are derived from the transformation matrix: R*y = t where t is the new direction and y = (0,1,0). The three equations are: (1) -sin(c) = t_x, (2) cos(a)*cos(c) = t_y and (3) sin(a) = t_z</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">asin</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="c1"># the term sign(math.asin(...)) is necessary because the direction of rotation depends on the quadrant in which the target direction is (function z = math.atan2(math.asin(-t[0]), t[1]) does more or less the same but with visible inaccuracy)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">sign</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">asin</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
        <span class="c1"># set rotation angles (degree) for 1st object</span>
        <span class="n">cmds</span><span class="o">.</span><span class="n">xform</span><span class="p">(</span><span class="n">objList</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ro</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">mul</span><span class="p">,</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="p">],</span> <span class="p">[</span><span class="mi">180</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">),</span> <span class="n">ws</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span></div>
        <span class="n">cmds</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Select exactly two coordinate systems!&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="getRotationMatrix"><a class="viewcode-back" href="../../pk_src.misc.html#pk_src.misc.getRotationMatrix">[docs]</a><span class="k">def</span> <span class="nf">getRotationMatrix</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;xyz&quot;</span><span class="p">,</span> <span class="n">rad</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate a Rotation Matrix for given euler angles</span>
<span class="sd">    :param alpha: angle for rotation around x-axis</span>
<span class="sd">    :type alpha: float</span>
<span class="sd">    :param beta: angle for rotation around y-axis</span>
<span class="sd">    :type beta: float</span>
<span class="sd">    :param gamma: angle for rotation around z-axis</span>
<span class="sd">    :type gamma: float</span>
<span class="sd">    :param order: rotation order</span>
<span class="sd">    :type order: str</span>
<span class="sd">    :param rad: set true for angles given in radians</span>
<span class="sd">    :type rad: bool</span>
<span class="sd">    :returns: rotation matrix for the rotations in the given order</span>

<span class="sd">    **Example:**</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            from pk_src import misc</span>
<span class="sd">            misc.getRotationMatrix(alpha=45, beta=60, gamma=10, order=&quot;xzy&quot;)</span>
<span class="sd">            # Result: matrix([[ 0.49240388,  0.55097853,  0.67376634,  0.        ],</span>
<span class="sd">            [ 0.17364818,  0.69636424, -0.69636424,  0.        ],</span>
<span class="sd">            [-0.85286853,  0.45989075,  0.24721603,  0.        ],</span>
<span class="sd">            [ 0.        ,  0.        ,  0.        ,  1.        ]]) #</span>
<span class="sd">            misc.getRotationMatrix(alpha=0, beta=90, gamma=0, order=&quot;xyz&quot;)</span>
<span class="sd">            # Result: matrix([[  6.12323400e-17,   0.00000000e+00,   1.00000000e+00,</span>
<span class="sd">               0.00000000e+00],</span>
<span class="sd">            [  0.00000000e+00,   1.00000000e+00,   0.00000000e+00,</span>
<span class="sd">               0.00000000e+00],</span>
<span class="sd">            [ -1.00000000e+00,   0.00000000e+00,   6.12323400e-17,</span>
<span class="sd">               0.00000000e+00],</span>
<span class="sd">            [  0.00000000e+00,   0.00000000e+00,   0.00000000e+00,</span>
<span class="sd">               1.00000000e+00]]) #</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">rad</span><span class="p">:</span>
        <span class="n">alpha</span> <span class="o">*=</span> <span class="n">GRAD_TO_RAD</span>
        <span class="n">beta</span> <span class="o">*=</span> <span class="n">GRAD_TO_RAD</span>
        <span class="n">gamma</span> <span class="o">*=</span> <span class="n">GRAD_TO_RAD</span>

    <span class="n">rotx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span>
                      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span>
                      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
    <span class="n">roty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span>
                      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                      <span class="p">[</span><span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span>
                      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
    <span class="n">rotz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                      <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>

    <span class="n">rot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>

    <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="n">order</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span>
            <span class="n">rot</span> <span class="o">=</span> <span class="n">rotx</span> <span class="o">*</span> <span class="n">rot</span>
        <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>
            <span class="n">rot</span> <span class="o">=</span> <span class="n">roty</span> <span class="o">*</span> <span class="n">rot</span>
        <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">&quot;z&quot;</span><span class="p">:</span>
            <span class="n">rot</span> <span class="o">=</span> <span class="n">rotz</span> <span class="o">*</span> <span class="n">rot</span>
</div>
    <span class="k">return</span> <span class="n">rot</span>

<div class="viewcode-block" id="getSkew"><a class="viewcode-back" href="../../pk_src.misc.html#pk_src.misc.getSkew">[docs]</a><span class="k">def</span> <span class="nf">getSkew</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                      <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span></div>
                      <span class="p">[</span><span class="o">-</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">]])</span>

<div class="viewcode-block" id="getRotationFromAToB"><a class="viewcode-back" href="../../pk_src.misc.html#pk_src.misc.getRotationFromAToB">[docs]</a><span class="k">def</span> <span class="nf">getRotationFromAToB</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate a rotation matrix to rotate the first vector in the place of the second vector. (In case of normed</span>
<span class="sd">        vectors, the vectors will overlap after rotating a with the rotation matrix).</span>
<span class="sd">        :param a: first vector, to be rotated</span>
<span class="sd">        :type a: np.matrix, shape (3,1)</span>
<span class="sd">        :param b: second vector, determines the position to achieve</span>
<span class="sd">        :type b: np.matrix, shape (3,1)</span>
<span class="sd">        :returns: rotation matrix for a rotation from a to b, as a np.matrix shape (3,3)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
    <span class="n">b_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">a_norm</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">b_norm</span><span class="o">.</span><span class="n">transpose</span><span class="p">()))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">,</span> <span class="n">b_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">I</span> <span class="o">+</span> <span class="n">getSkew</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">A1</span><span class="p">)</span> <span class="o">+</span> <span class="n">getSkew</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">A1</span><span class="p">)</span> <span class="o">*</span> <span class="n">getSkew</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">A1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">c</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">v_norm</span> <span class="o">=</span> <span class="n">v</span> <span class="o">/</span> <span class="n">s</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span>
            <span class="p">[[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">],</span>
             <span class="p">[</span><span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">],</span>
             <span class="p">[</span><span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]])</span>
</div>
    <span class="k">return</span> <span class="n">R</span>

<div class="viewcode-block" id="getEulerAnglesToMatrix"><a class="viewcode-back" href="../../pk_src.misc.html#pk_src.misc.getEulerAnglesToMatrix">[docs]</a><span class="k">def</span> <span class="nf">getEulerAnglesToMatrix</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the Euler Angles for a given rotation matrix</span>
<span class="sd">        :param m: rotation matrix</span>
<span class="sd">        :type m: np.matrix, shape (3,3)</span>
<span class="sd">        :returns: [alpha, beta, gamma] for rotation around global X, Y, Z axis in that order</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">RAD_TO_DEG</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="o">-</span><span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                      <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">)))</span> <span class="o">*</span> <span class="n">RAD_TO_DEG</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">RAD_TO_DEG</span></div>
    <span class="k">return</span> <span class="p">[</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">]</span>

<div class="viewcode-block" id="getRotationAroundAxis"><a class="viewcode-back" href="../../pk_src.misc.html#pk_src.misc.getRotationAroundAxis">[docs]</a><span class="k">def</span> <span class="nf">getRotationAroundAxis</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">rad</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">rad</span><span class="p">:</span>
        <span class="n">angle</span> <span class="o">*=</span> <span class="n">DEG_TO_RAD</span>
    <span class="n">v_norm</span> <span class="o">=</span> <span class="n">v</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span> <span class="o">*</span> <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span>
                       <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span> <span class="o">-</span> <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span>
                       <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span> <span class="o">+</span> <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)],</span>
                      <span class="p">[</span><span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span> <span class="o">+</span> <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span>
                       <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span> <span class="o">*</span> <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span>
                       <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span> <span class="o">-</span> <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)],</span>
                      <span class="p">[</span><span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span> <span class="o">-</span> <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span>
                       <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span> <span class="o">+</span> <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span></div>
                       <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span> <span class="o">*</span> <span class="n">v_norm</span><span class="o">.</span><span class="n">A1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)]])</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Enrico Reich.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>